import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import React, { useState, useEffect } from 'react';
import { analyzeLocationSafety } from '@/services/geminiService';
const MapView = ({ children }) => {
    const [selectedChildId, setSelectedChildId] = useState(children[0]?.id || '');
    const child = children.find(c => c.id === selectedChildId) || children[0];
    const [intel, setIntel] = useState(null);
    const [loadingIntel, setLoadingIntel] = useState(false);
    const getSafetyAnalysis = async () => {
        if (!child.location)
            return;
        setLoadingIntel(true);
        const result = await analyzeLocationSafety(child.location.lat, child.location.lng);
        setIntel(result);
        setLoadingIntel(false);
    };
    useEffect(() => {
        setIntel(null);
    }, [selectedChildId]);
    return (_jsxs("div", { className: "h-[calc(100vh-180px)] flex flex-col lg:flex-row gap-6 animate-in fade-in duration-700", dir: "rtl", children: [_jsxs("div", { className: "lg:w-80 flex flex-col gap-4 overflow-y-auto custom-scrollbar pr-2", children: [_jsx("h2", { className: "text-2xl font-black text-slate-800 mb-2 px-2 tracking-tighter", children: "\u062A\u062A\u0628\u0639 \u0627\u0644\u0639\u0627\u0626\u0644\u0629" }), children.map(c => (_jsxs("button", { onClick: () => setSelectedChildId(c.id), className: `p-5 rounded-[2.5rem] border-2 transition-all text-right flex items-center gap-4 ${selectedChildId === c.id
                            ? 'bg-indigo-600 border-indigo-400 text-white shadow-xl shadow-indigo-100'
                            : 'bg-white border-slate-50 text-slate-600 hover:border-slate-200 shadow-sm'}`, children: [_jsxs("div", { className: "relative", children: [_jsx("img", { src: c.avatar, className: "w-12 h-12 rounded-2xl object-cover border-2 border-white" }), _jsx("div", { className: `absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${c.status === 'online' ? 'bg-green-500' : 'bg-slate-300'}` })] }), _jsxs("div", { className: "flex-1 overflow-hidden", children: [_jsx("p", { className: "font-black text-sm truncate", children: c.name }), _jsx("p", { className: `text-[10px] font-bold ${selectedChildId === c.id ? 'text-indigo-200' : 'text-slate-400'} truncate`, children: c.location?.address || 'الموقع غير متاح' })] })] }, c.id))), _jsxs("div", { className: "mt-auto p-6 bg-slate-900 rounded-[2.5rem] text-white space-y-4", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-3 h-3 bg-indigo-500 rounded-full animate-pulse" }), _jsx("p", { className: "text-[10px] font-black uppercase tracking-widest text-indigo-300", children: "\u0646\u0638\u0627\u0645 \u062A\u062D\u062F\u064A\u062F \u0627\u0644\u0645\u0648\u0627\u0642\u0639 \u0646\u0634\u0637" })] }), _jsx("p", { className: "text-[11px] font-bold leading-relaxed opacity-70", children: "\u064A\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0625\u062D\u062F\u0627\u062B\u064A\u0627\u062A \u0643\u0644 30 \u062B\u0627\u0646\u064A\u0629 \u0644\u0636\u0645\u0627\u0646 \u0627\u0644\u062F\u0642\u0629 \u0627\u0644\u0639\u0627\u0644\u064A\u0629." })] })] }), _jsx("div", { className: "flex-1 bg-white rounded-[3.5rem] shadow-2xl border-4 border-white overflow-hidden relative group", children: child.location ? (_jsxs(_Fragment, { children: [_jsx("iframe", { width: "100%", height: "100%", frameBorder: "0", scrolling: "no", marginHeight: 0, marginWidth: 0, src: `https://maps.google.com/maps?q=${child.location.lat},${child.location.lng}&z=16&output=embed`, className: "grayscale-[0.1] contrast-[1.05]" }), _jsxs("div", { className: "absolute top-6 left-6 right-6 flex justify-between items-start pointer-events-none", children: [_jsx("div", { className: "bg-white/90 backdrop-blur-md p-4 rounded-3xl shadow-2xl border border-white pointer-events-auto", children: _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center font-black", children: "\uD83D\uDCCD" }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "text-[9px] font-black text-slate-400 uppercase tracking-widest", children: "\u0627\u0644\u0645\u0648\u0642\u0639 \u0627\u0644\u062D\u0627\u0644\u064A" }), _jsx("p", { className: "text-xs font-black text-slate-800", children: child.location.address })] })] }) }), _jsxs("button", { onClick: getSafetyAnalysis, disabled: loadingIntel, className: "bg-slate-900 text-white px-8 py-4 rounded-full font-black text-xs shadow-2xl pointer-events-auto active:scale-95 transition-all flex items-center gap-3", children: [loadingIntel ? _jsx("span", { className: "animate-spin", children: "\u23F3" }) : '🧠', "\u062A\u062D\u0644\u064A\u0644 \u0623\u0645\u0627\u0646 \u0627\u0644\u0645\u0646\u0637\u0642\u0629"] })] }), intel && (_jsxs("div", { className: "absolute bottom-6 left-6 right-6 lg:right-auto lg:w-96 bg-white/95 backdrop-blur-xl p-8 rounded-[2.5rem] shadow-2xl border border-indigo-100 animate-in slide-in-from-bottom-5 duration-500", children: [_jsxs("div", { className: "flex items-center justify-between mb-4", children: [_jsx("h4", { className: "text-sm font-black text-indigo-600 uppercase tracking-widest", children: "\u0630\u0643\u0627\u0621 \u0627\u0644\u0645\u0643\u0627\u0646 (Spatial Intel)" }), _jsx("button", { onClick: () => setIntel(null), className: "text-slate-300 hover:text-slate-600", children: "\u2715" })] }), _jsxs("p", { className: "text-xs font-bold text-slate-700 leading-relaxed mb-6", children: ["\"", intel.text, "\""] }), intel.mapsLinks.length > 0 && (_jsxs("div", { className: "space-y-2", children: [_jsx("p", { className: "text-[9px] font-black text-slate-400 uppercase", children: "\u0645\u0646\u0627\u0637\u0642 \u0622\u0645\u0646\u0629 \u0642\u0631\u064A\u0628\u0629:" }), _jsx("div", { className: "flex flex-wrap gap-2", children: intel.mapsLinks.slice(0, 3).map((link, idx) => (_jsxs("a", { href: link.uri, target: "_blank", rel: "noreferrer", className: "bg-indigo-50 text-indigo-700 px-4 py-2 rounded-xl text-[10px] font-black border border-indigo-100 hover:bg-indigo-100 transition-colors", children: [link.title, " \u2197\uFE0F"] }, idx))) })] }))] }))] })) : (_jsxs("div", { className: "h-full flex flex-col items-center justify-center bg-slate-50 space-y-6", children: [_jsx("div", { className: "w-32 h-32 bg-white rounded-[3rem] shadow-xl flex items-center justify-center text-6xl opacity-20 animate-pulse", children: "\uD83C\uDF0D" }), _jsxs("div", { className: "text-center", children: [_jsx("h3", { className: "text-xl font-black text-slate-400", children: "\u0625\u062D\u062F\u0627\u062B\u064A\u0627\u062A \u0627\u0644\u0645\u0648\u0642\u0639 \u063A\u064A\u0631 \u0645\u062A\u0648\u0641\u0631\u0629" }), _jsxs("p", { className: "text-xs font-bold text-slate-300", children: ["\u062A\u0623\u0643\u062F \u0645\u0646 \u062A\u0641\u0639\u064A\u0644 \u062E\u062F\u0645\u0629 \u0627\u0644\u0645\u0648\u0627\u0642\u0639 \u0641\u064A \u062C\u0647\u0627\u0632 ", child.name] })] })] })) })] }));
};
export default MapView;
