import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import React, { useState, useEffect } from 'react';
import { AmanahShield } from '@/constants';
import { createSovereignPairCode } from '@/services/firestoreService';
const DeviceEnrollmentView = ({ currentUser, children }) => {
    const [pairCode, setPairCode] = useState('----');
    const [timeLeft, setTimeLeft] = useState(0);
    const [selectedChildId, setSelectedChildId] = useState(children[0]?.id || '');
    const [isGenerating, setIsGenerating] = useState(false);
    const generateNewCode = async () => {
        if (!selectedChildId)
            return alert("يرجى اختيار الطفل أولاً.");
        setIsGenerating(true);
        const code = await createSovereignPairCode(currentUser.id, selectedChildId);
        if (code) {
            setPairCode(code);
            setTimeLeft(180); // 3 دقائق TTL حسب الوثيقة
        }
        setIsGenerating(false);
    };
    useEffect(() => {
        if (timeLeft <= 0)
            return;
        const timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);
        return () => clearInterval(timer);
    }, [timeLeft]);
    return (_jsx("div", { className: "max-w-4xl mx-auto py-12 animate-in zoom-in-95 duration-500", dir: "rtl", children: _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-12 gap-10", children: [_jsxs("div", { className: "lg:col-span-7 bg-white rounded-[4rem] shadow-2xl border-4 border-white p-12 space-y-10 text-center", children: [_jsx("div", { className: "w-24 h-24 bg-indigo-600 rounded-[2.5rem] mx-auto flex items-center justify-center shadow-[0_20px_50px_rgba(79,70,229,0.3)]", children: _jsx(AmanahShield, { className: "w-16 h-16", animate: timeLeft > 0 }) }), _jsxs("div", { className: "space-y-4", children: [_jsx("h2", { className: "text-4xl font-black text-slate-900 tracking-tighter", children: "\u0631\u0628\u0637 \u062C\u0647\u0627\u0632 \u0633\u064A\u0627\u062F\u064A" }), _jsxs("p", { className: "text-slate-400 font-bold px-10 leading-relaxed text-sm", children: ["\u0633\u064A\u062A\u0645 \u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0640 Device Binding \u0644\u0631\u0628\u0637 \u0647\u0627\u062A\u0641 \u0627\u0644\u0637\u0641\u0644 ", children.find(c => c.id === selectedChildId)?.name, " \u0628\u0627\u0644\u0646\u0648\u0627\u0629 \u0627\u0644\u0645\u0631\u0643\u0632\u064A\u0629."] })] }), _jsx("div", { className: "w-full bg-slate-50 border-2 border-slate-100 rounded-[3rem] p-10 space-y-8 relative overflow-hidden", children: timeLeft > 0 ? (_jsxs(_Fragment, { children: [_jsx("div", { className: "absolute top-0 right-0 left-0 h-2 bg-slate-200", children: _jsx("div", { className: "h-full bg-indigo-600 transition-all duration-1000", style: { width: `${(timeLeft / 180) * 100}%` } }) }), _jsxs("div", { className: "space-y-2 pt-4", children: [_jsx("code", { className: "text-6xl font-mono font-black tracking-[0.2em] text-indigo-600 block", children: pairCode }), _jsx("p", { className: "text-[10px] font-mono text-slate-400", children: "SIGNING_ROOT: AMANAH_KMS_V1_STABLE" })] }), _jsxs("div", { className: "flex items-center justify-center gap-3", children: [_jsx("span", { className: "w-2 h-2 bg-red-600 rounded-full animate-pulse" }), _jsxs("p", { className: "text-[11px] font-black text-slate-600 uppercase tracking-widest", children: ["\u062A\u0646\u062A\u0647\u064A \u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0629 \u062E\u0644\u0627\u0644 ", Math.floor(timeLeft / 60), ":", (timeLeft % 60).toString().padStart(2, '0')] })] })] })) : (_jsxs("div", { className: "py-10 space-y-8", children: [_jsx("div", { className: "text-5xl", children: "\u23F3" }), _jsxs("div", { className: "space-y-4", children: [_jsx("label", { className: "text-[10px] font-black text-slate-400 uppercase tracking-widest block", children: "\u0627\u062E\u062A\u0631 \u0627\u0644\u0637\u0641\u0644 \u0644\u0625\u0646\u0634\u0627\u0621 \u0631\u0645\u0632 \u0645\u062E\u0635\u0635 \u0644\u0647" }), _jsx("select", { value: selectedChildId, onChange: e => setSelectedChildId(e.target.value), className: "w-full p-5 bg-white border border-slate-200 rounded-2xl font-black text-right outline-none", children: children.map(c => _jsx("option", { value: c.id, children: c.name }, c.id)) })] }), _jsx("button", { onClick: generateNewCode, disabled: isGenerating, className: "w-full py-6 bg-indigo-600 text-white rounded-3xl font-black shadow-xl active:scale-95 transition-all hover:scale-105", children: isGenerating ? 'جاري التوليد...' : 'توليد رمز ربط سيادي' })] })) })] }), _jsxs("div", { className: "lg:col-span-5 space-y-8", children: [_jsxs("div", { className: "bg-indigo-950 p-10 rounded-[3rem] text-white shadow-2xl space-y-10 relative overflow-hidden", children: [_jsx("div", { className: "absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl" }), _jsx("h3", { className: "text-2xl font-black border-b border-white/10 pb-6", children: "\u0628\u0631\u0648\u062A\u0648\u0643\u0648\u0644 \u0627\u0644\u062A\u062D\u0635\u064A\u0646 (Binding)" }), _jsxs("div", { className: "space-y-8 relative z-10", children: [_jsx(BindingStep, { icon: "\uD83D\uDD11", title: "\u062A\u0648\u0644\u064A\u062F \u0645\u0641\u062A\u0627\u062D RSA", desc: "\u064A\u0642\u0648\u0645 \u0647\u0627\u062A\u0641 \u0627\u0644\u0637\u0641\u0644 \u0628\u062A\u0648\u0644\u064A\u062F \u0645\u0641\u062A\u0627\u062D 4096-bit \u062F\u0627\u062E\u0644 \u0627\u0644\u0640 Keystore \u0627\u0644\u0622\u0645\u0646." }), _jsx(BindingStep, { icon: "\uD83E\uDD1D", title: "\u0627\u0644\u0645\u0635\u0627\u0641\u062D\u0629 \u0627\u0644\u0631\u0642\u0645\u064A\u0629", desc: "\u064A\u062A\u0645 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0645\u0641\u062A\u0627\u062D \u0627\u0644\u0639\u0627\u0645 \u0645\u0639 \u0627\u0644\u0640 Pair Code \u0644\u0644\u062E\u0627\u062F\u0645 \u0644\u0644\u0627\u0631\u062A\u0628\u0627\u0637." }), _jsx(BindingStep, { icon: "\uD83D\uDEE1\uFE0F", title: "\u0628\u0635\u0645\u0629 \u0627\u0644\u062A\u062B\u0628\u064A\u062A", desc: "\u064A\u062A\u0645 \u0631\u0628\u0637 \u0627\u0644\u062C\u0644\u0633\u0629 \u0628\u0640 Install ID \u0641\u0631\u064A\u062F \u0644\u0645\u0646\u0639 \u0627\u0633\u062A\u0646\u0633\u0627\u062E \u0627\u0644\u062A\u0637\u0628\u064A\u0642." })] })] }), _jsxs("div", { className: "bg-white p-8 rounded-[3rem] border border-slate-100 shadow-xl", children: [_jsxs("h4", { className: "text-lg font-black text-slate-800 mb-4 flex items-center gap-3", children: [_jsx("span", { className: "p-2 bg-amber-50 text-amber-600 rounded-lg", children: "\u26A0\uFE0F" }), "\u0633\u064A\u0627\u0633\u0629 \u0627\u0644\u0623\u0645\u0646 (v1)"] }), _jsxs("ul", { className: "space-y-3", children: [_jsxs("li", { className: "flex items-center gap-3 text-xs font-bold text-slate-500", children: [_jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-slate-300" }), "\u0627\u0644\u0631\u0645\u0632 \u0635\u0627\u0644\u062D \u0644\u0645\u0631\u0629 \u0648\u0627\u062D\u062F\u0629 \u0648\u0644\u0637\u0641\u0644 \u0648\u0627\u062D\u062F \u0641\u0642\u0637."] }), _jsxs("li", { className: "flex items-center gap-3 text-xs font-bold text-slate-500", children: [_jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-slate-300" }), "\u064A\u062A\u0645 \u062A\u062F\u0648\u064A\u0631 (Rotate) \u062A\u0648\u0643\u0646 \u0627\u0644\u062C\u0647\u0627\u0632 \u0643\u0644 30 \u064A\u0648\u0645 \u062A\u0644\u0642\u0627\u0626\u064A\u0627\u064B."] })] })] })] })] }) }));
};
const BindingStep = ({ icon, title, desc }) => (_jsxs("div", { className: "flex items-start gap-5", children: [_jsx("div", { className: "w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-2xl border border-white/10 shadow-inner", children: icon }), _jsxs("div", { className: "flex-1", children: [_jsx("p", { className: "font-black text-sm text-indigo-300 mb-1", children: title }), _jsx("p", { className: "text-[10px] font-bold text-indigo-100/60 leading-relaxed", children: desc })] })] }));
export default DeviceEnrollmentView;
