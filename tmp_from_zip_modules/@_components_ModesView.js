import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useState, useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import { ICONS } from '@/constants';
const ModesView = ({ modes, children, onUpdateModes, onApplyMode }) => {
    const location = useLocation();
    const [editingMode, setEditingMode] = useState(null);
    const [suggestedPlan, setSuggestedPlan] = useState(null);
    // التحقق من وجود وضع مقترح قادم من صفحة النبض النفسي عبر الـ state
    useEffect(() => {
        if (location.state && location.state.suggestedMode) {
            const plan = location.state.suggestedMode;
            setSuggestedPlan(plan);
            setEditingMode(plan); // فتح واجهة التعديل فوراً للخطة المقترحة
        }
    }, [location.state]);
    const handleSaveMode = () => {
        if (!editingMode?.name)
            return;
        const modeToSave = {
            id: editingMode.id || 'mode-' + Date.now(),
            name: editingMode.name,
            color: editingMode.color || 'bg-indigo-600',
            icon: editingMode.icon || '🛡️',
            allowedApps: editingMode.allowedApps || [],
            allowedUrls: editingMode.allowedUrls || [],
            blacklistedUrls: editingMode.blacklistedUrls || [],
            cameraEnabled: editingMode.cameraEnabled ?? true,
            micEnabled: editingMode.micEnabled ?? true,
            isInternetCut: editingMode.isInternetCut ?? false,
            isScreenDimmed: editingMode.isScreenDimmed ?? false,
            isDeviceLocked: editingMode.isDeviceLocked ?? false,
            internetStartTime: editingMode.internetStartTime || '08:00',
            internetEndTime: editingMode.internetEndTime || '21:00',
            activeDays: editingMode.activeDays || [0, 1, 2, 3, 4, 5, 6]
        };
        // تحديث قائمة الأوضاع (إضافة أو تعديل)
        onUpdateModes(modes.find(m => m.id === modeToSave.id)
            ? modes.map(m => m.id === modeToSave.id ? modeToSave : m)
            : [...modes, modeToSave]);
        setEditingMode(null);
        setSuggestedPlan(null);
    };
    return (_jsxs("div", { className: "max-w-5xl mx-auto space-y-10 pb-40 animate-in fade-in", dir: "rtl", children: [suggestedPlan && (_jsxs("div", { className: "bg-red-600 p-8 rounded-[3rem] text-white shadow-2xl flex flex-col md:flex-row items-center justify-between gap-6 border-b-8 border-red-800 animate-in slide-in-from-top duration-500", children: [_jsxs("div", { className: "flex items-center gap-6 text-right", children: [_jsx("div", { className: "w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-red-600 text-3xl shadow-xl", children: "\u26A0\uFE0F" }), _jsxs("div", { children: [_jsxs("h3", { className: "text-2xl font-black", children: ["\u0627\u0642\u062A\u0631\u0627\u062D \u0630\u0643\u0627\u0621 \u0627\u0635\u0637\u0646\u0627\u0639\u064A \u0644\u0640 ", suggestedPlan.name] }), _jsx("p", { className: "text-sm font-bold opacity-80", children: "\u062A\u0645 \u0625\u0646\u0634\u0627\u0621 \u0647\u0630\u0627 \u0627\u0644\u0648\u0636\u0639 \u0628\u0646\u0627\u0621\u064B \u0639\u0644\u0649 \u0627\u0644\u062A\u063A\u064A\u0631\u0627\u062A \u0627\u0644\u0623\u062E\u064A\u0631\u0629 \u0641\u064A \u0646\u0628\u0636 \u0627\u0644\u0637\u0641\u0644 \u0627\u0644\u0646\u0641\u0633\u064A." })] })] }), _jsxs("div", { className: "flex gap-4", children: [_jsx("button", { onClick: handleSaveMode, className: "bg-white text-red-600 px-8 py-4 rounded-2xl font-black text-sm shadow-xl hover:scale-105 active:scale-95 transition-all", children: "\u0627\u0639\u062A\u0645\u0627\u062F \u0627\u0644\u0648\u0636\u0639" }), _jsx("button", { onClick: () => setSuggestedPlan(null), className: "bg-red-700 text-white px-8 py-4 rounded-2xl font-black text-sm border border-red-500", children: "\u062A\u062C\u0627\u0647\u0644" })] })] })), _jsxs("div", { className: "flex flex-col md:flex-row justify-between items-center gap-6 text-right", children: [_jsxs("div", { children: [_jsx("h2", { className: "text-4xl font-black text-slate-900 tracking-tighter", children: "\u0627\u0644\u0623\u0648\u0636\u0627\u0639 \u0627\u0644\u0630\u0643\u064A\u0629 (Modes)" }), _jsx("p", { className: "text-slate-500 font-bold mt-1", children: "\u0627\u0644\u0642\u0648\u0627\u0639\u062F \u0627\u0644\u0645\u0642\u0631\u0631\u0629 \u0644\u062A\u0637\u0628\u064A\u0642\u0627\u062A \u0637\u0641\u0644\u0643\u060C \u0627\u0644\u0643\u0627\u0645\u064A\u0631\u0627\u060C \u0648\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A." })] }), _jsxs("button", { onClick: () => setEditingMode({ name: '', icon: '⚡', color: 'bg-indigo-600' }), className: "bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black shadow-lg hover:bg-indigo-700 transition-all flex items-center gap-3 active:scale-95", children: [_jsx(ICONS.Plus, {}), "\u0625\u0646\u0634\u0627\u0621 \u0648\u0636\u0639 \u0645\u062E\u0635\u0635"] })] }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-8", children: modes.map(mode => (_jsxs("div", { className: "bg-white rounded-[3rem] border border-slate-100 shadow-xl p-8 space-y-8 hover:shadow-2xl transition-all group relative overflow-hidden text-right border-b-4 border-indigo-100", children: [_jsxs("div", { className: "flex justify-between items-start", children: [_jsx("button", { onClick: () => setEditingMode(mode), className: "p-4 bg-slate-50 text-slate-400 hover:text-indigo-600 rounded-2xl transition-all border border-transparent hover:border-indigo-100 shadow-sm", children: _jsx(ICONS.Settings, {}) }), _jsxs("div", { className: "flex items-center gap-5", children: [_jsxs("div", { children: [_jsx("h3", { className: "text-2xl font-black text-slate-800 tracking-tight", children: mode.name }), _jsx("div", { className: "flex gap-2 justify-end mt-1", children: _jsxs("span", { className: "text-[9px] font-black text-slate-400 bg-slate-100 px-2 py-0.5 rounded uppercase tracking-widest", children: [mode.internetStartTime, " - ", mode.internetEndTime] }) })] }), _jsx("div", { className: `w-16 h-16 ${mode.color} rounded-3xl flex items-center justify-center text-4xl shadow-lg text-white`, children: mode.icon })] })] }), _jsxs("div", { className: "grid grid-cols-3 gap-3", children: [_jsxs("div", { className: `p-4 rounded-2xl text-center ${mode.cameraEnabled ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'}`, children: [_jsx("p", { className: "text-[10px] font-black mb-1 uppercase tracking-tighter", children: "\u0627\u0644\u0643\u0627\u0645\u064A\u0631\u0627" }), _jsx("p", { className: "font-bold text-xs", children: mode.cameraEnabled ? 'مفعلة' : 'محجوبة' })] }), _jsxs("div", { className: `p-4 rounded-2xl text-center ${!mode.isInternetCut ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'}`, children: [_jsx("p", { className: "text-[10px] font-black mb-1 uppercase tracking-tighter", children: "\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A" }), _jsx("p", { className: "font-bold text-xs", children: !mode.isInternetCut ? 'متصل' : 'مقطوع' })] }), _jsxs("div", { className: `p-4 rounded-2xl text-center ${!mode.isDeviceLocked ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'}`, children: [_jsx("p", { className: "text-[10px] font-black mb-1 uppercase tracking-tighter", children: "\u0627\u0644\u062C\u0647\u0627\u0632" }), _jsx("p", { className: "font-bold text-xs", children: !mode.isDeviceLocked ? 'مفتوح' : 'مغلق' })] })] }), _jsxs("div", { className: "pt-6 border-t border-slate-50", children: [_jsx("p", { className: "text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest", children: "\u0627\u0644\u062A\u0637\u0628\u064A\u0642 \u0627\u0644\u0633\u0631\u064A\u0639 \u0639\u0644\u0649 \u0627\u0644\u0623\u0637\u0641\u0627\u0644:" }), _jsx("div", { className: "flex flex-wrap gap-3 justify-end", children: children.map(child => (_jsxs("button", { onClick: () => onApplyMode(child.id, mode.id), className: "flex items-center gap-3 px-6 py-3 bg-white hover:bg-indigo-50 rounded-full border border-slate-100 transition-all active:scale-90 shadow-sm group", children: [_jsx("span", { className: "text-[11px] font-black text-slate-700 group-hover:text-indigo-600", children: child.name }), _jsx("img", { src: child.avatar, className: "w-8 h-8 rounded-full object-cover border-2 border-white shadow-sm" })] }, child.id))) })] })] }, mode.id))) }), editingMode && (_jsx("div", { className: "fixed inset-0 z-[6000] flex items-end sm:items-center justify-center p-0 sm:p-6 bg-slate-950/80 backdrop-blur-md animate-in fade-in", children: _jsxs("div", { className: "bg-white w-full max-w-2xl rounded-t-[4rem] sm:rounded-[4rem] shadow-2xl overflow-hidden flex flex-col max-h-[95vh] border-x-4 border-t-4 border-white text-right", children: [_jsxs("div", { className: `p-10 text-white flex justify-between items-center ${editingMode.color || 'bg-indigo-600'} transition-colors duration-500`, children: [_jsx("button", { onClick: () => { setEditingMode(null); setSuggestedPlan(null); }, className: "p-4 hover:bg-white/20 rounded-full transition-all border border-white/20", children: _jsx(ICONS.Close, {}) }), _jsxs("div", { children: [_jsx("h3", { className: "text-3xl font-black", children: editingMode.id ? 'تعديل النمط' : 'إنشاء نمط جديد' }), _jsx("p", { className: "text-xs font-bold opacity-70", children: "\u062E\u0635\u0635 \u0627\u0644\u0642\u0648\u0627\u0639\u062F \u0648\u0627\u0644\u0642\u064A\u0648\u062F \u0627\u0644\u062A\u0642\u0646\u064A\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u0648\u0636\u0639." })] })] }), _jsxs("div", { className: "p-10 space-y-10 overflow-y-auto custom-scrollbar flex-1 pb-16", children: [_jsxs("div", { className: "space-y-4", children: [_jsx("label", { className: "text-[11px] font-black text-slate-400 uppercase px-4 tracking-widest", children: "\u0627\u0633\u0645 \u0627\u0644\u0646\u0645\u0637" }), _jsx("input", { value: editingMode.name, onChange: e => setEditingMode({ ...editingMode, name: e.target.value }), placeholder: "\u0645\u062B\u0644\u0627\u064B: \u0648\u0642\u062A \u0627\u0644\u0645\u0630\u0627\u0643\u0631\u0629", className: "w-full p-6 bg-slate-50 border border-slate-100 rounded-[2.5rem] outline-none font-black text-2xl shadow-inner text-right focus:border-indigo-500 transition-all" })] }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-4", children: [_jsx("label", { className: "text-[11px] font-black text-slate-400 uppercase px-4 tracking-widest block", children: "\u0646\u0647\u0627\u064A\u0629 \u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A" }), _jsx("input", { type: "time", value: editingMode.internetEndTime, onChange: e => setEditingMode({ ...editingMode, internetEndTime: e.target.value }), className: "w-full p-6 bg-slate-50 border border-slate-100 rounded-3xl font-black text-center text-xl" })] }), _jsxs("div", { className: "space-y-4", children: [_jsx("label", { className: "text-[11px] font-black text-slate-400 uppercase px-4 tracking-widest block", children: "\u0628\u062F\u0627\u064A\u0629 \u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A" }), _jsx("input", { type: "time", value: editingMode.internetStartTime, onChange: e => setEditingMode({ ...editingMode, internetStartTime: e.target.value }), className: "w-full p-6 bg-slate-50 border border-slate-100 rounded-3xl font-black text-center text-xl" })] })] }), _jsxs("div", { className: "space-y-6", children: [_jsx("label", { className: "text-[11px] font-black text-slate-400 uppercase px-4 tracking-widest block", children: "\u062E\u064A\u0627\u0631\u0627\u062A \u0627\u0644\u062A\u062D\u0643\u0645 \u0628\u0627\u0644\u0639\u062A\u0627\u062F" }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsxs("button", { onClick: () => setEditingMode({ ...editingMode, cameraEnabled: !editingMode.cameraEnabled }), className: `p-6 rounded-[2rem] border-2 transition-all flex items-center justify-between ${editingMode.cameraEnabled ? 'bg-emerald-50 border-emerald-200 text-emerald-700' : 'bg-red-50 border-red-200 text-red-700'}`, children: [_jsx("span", { className: "text-2xl", children: editingMode.cameraEnabled ? '📷' : '🚫' }), _jsxs("span", { className: "font-black text-xs", children: ["\u0627\u0644\u0643\u0627\u0645\u064A\u0631\u0627: ", editingMode.cameraEnabled ? 'مفعلة' : 'محجوبة'] })] }), _jsxs("button", { onClick: () => setEditingMode({ ...editingMode, isInternetCut: !editingMode.isInternetCut }), className: `p-6 rounded-[2rem] border-2 transition-all flex items-center justify-between ${!editingMode.isInternetCut ? 'bg-emerald-50 border-emerald-200 text-emerald-700' : 'bg-red-50 border-red-200 text-red-700'}`, children: [_jsx("span", { className: "text-2xl", children: !editingMode.isInternetCut ? '📡' : '✂️' }), _jsxs("span", { className: "font-black text-xs", children: ["\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A: ", !editingMode.isInternetCut ? 'نشط' : 'مقطوع'] })] }), _jsxs("button", { onClick: () => setEditingMode({ ...editingMode, isDeviceLocked: !editingMode.isDeviceLocked }), className: `p-6 rounded-[2rem] border-2 transition-all flex items-center justify-between ${!editingMode.isDeviceLocked ? 'bg-emerald-50 border-emerald-200 text-emerald-700' : 'bg-red-50 border-red-200 text-red-700'}`, children: [_jsx("span", { className: "text-2xl", children: !editingMode.isDeviceLocked ? '📱' : '🔒' }), _jsxs("span", { className: "font-black text-xs", children: ["\u0627\u0644\u062C\u0647\u0627\u0632: ", !editingMode.isDeviceLocked ? 'مفتوح' : 'مقفل'] })] })] })] })] }), _jsxs("div", { className: "p-10 bg-slate-50 border-t border-slate-100 flex gap-4 pb-14 sm:pb-10", children: [_jsx("button", { onClick: handleSaveMode, className: "flex-1 bg-indigo-600 text-white py-6 rounded-[2.5rem] font-black text-xl shadow-2xl active:scale-95 transition-all", children: suggestedPlan ? 'اعتماد وحفظ خطة الذكاء الاصطناعي' : 'حفظ التغييرات' }), _jsx("button", { onClick: () => { setEditingMode(null); setSuggestedPlan(null); }, className: "px-10 bg-white text-slate-400 py-6 rounded-[2.5rem] font-black text-xl border border-slate-200", children: "\u0625\u0644\u063A\u0627\u0621" })] })] }) }))] }));
};
export default ModesView;
