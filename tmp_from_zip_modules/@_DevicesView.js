import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useState } from 'react';
import { ICONS } from '@/constants';
import { analyzeLocationSafety } from '@/services/geminiService';
const DevicesView = ({ children, onToggleAppBlock, onUpdateDevice }) => {
    const [selectedChildId, setSelectedChildId] = useState(children[0]?.id || '');
    const child = children.find(c => c.id === selectedChildId) || children[0];
    const [loadingLocation, setLoadingLocation] = useState(false);
    const [locationIntel, setLocationIntel] = useState(null);
    if (!child)
        return _jsx("div", { className: "p-10 text-center font-black", children: "\u0644\u0627 \u064A\u0648\u062C\u062F \u0623\u0637\u0641\u0627\u0644 \u0645\u0636\u0627\u0641\u064A\u0646 \u062D\u0627\u0644\u064A\u0627\u064B." });
    const trackLocation = () => {
        setLoadingLocation(true);
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const { latitude, longitude } = pos.coords;
            onUpdateDevice(child.id, { location: { lat: latitude, lng: longitude, address: "جاري تحديد العنوان...", lastUpdated: new Date() } });
            const intel = await analyzeLocationSafety(latitude, longitude);
            setLocationIntel(intel);
            setLoadingLocation(false);
        }, () => {
            alert("يرجى تفعيل صلاحيات الموقع الجغرافي.");
            setLoadingLocation(false);
        });
    };
    return (_jsxs("div", { className: "space-y-10 pb-32 animate-in fade-in duration-700", dir: "rtl", children: [_jsxs("div", { className: "flex flex-col md:flex-row justify-between items-center gap-6", children: [_jsx("div", { className: "flex gap-4 overflow-x-auto pb-2 custom-scrollbar flex-1", children: children.map(c => (_jsxs("button", { onClick: () => setSelectedChildId(c.id), className: `flex items-center gap-3 px-8 py-4 rounded-full border-2 transition-all whitespace-nowrap ${selectedChildId === c.id ? 'bg-indigo-600 border-indigo-400 text-white shadow-xl' : 'bg-white border-slate-100 text-slate-500'}`, children: [_jsx("img", { src: c.avatar, className: "w-10 h-10 rounded-xl object-cover border-2 border-white" }), _jsx("span", { className: "font-black text-sm", children: c.name })] }, c.id))) }), _jsxs("div", { className: "bg-slate-900 text-white p-6 rounded-[2.5rem] flex items-center gap-8 shadow-2xl border-b-4 border-indigo-600", children: [_jsxs("div", { className: "flex flex-col items-center gap-1", children: [_jsx("p", { className: "text-[8px] font-black text-indigo-400 uppercase", children: "\u0627\u0644\u0628\u0637\u0627\u0631\u064A\u0629" }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: `w-8 h-4 rounded-sm border border-white/40 p-0.5 relative`, children: _jsx("div", { className: `h-full ${child.batteryLevel > 20 ? 'bg-emerald-500' : 'bg-red-500'}`, style: { width: `${child.batteryLevel}%` } }) }), _jsxs("span", { className: "text-[10px] font-black", children: [child.batteryLevel, "%"] })] })] }), _jsxs("div", { className: "flex flex-col items-center gap-1", children: [_jsx("p", { className: "text-[8px] font-black text-indigo-400 uppercase", children: "\u0627\u0644\u0634\u0628\u0643\u0629" }), _jsx("div", { className: "flex items-end gap-0.5 h-4", children: [1, 2, 3, 4].map(i => _jsx("div", { className: `w-1 rounded-full ${child.signalStrength >= i ? 'bg-indigo-500' : 'bg-white/10'}`, style: { height: `${i * 25}%` } }, i)) })] })] })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-12 gap-10", children: [_jsxs("div", { className: "lg:col-span-8 bg-white/70 backdrop-blur-2xl rounded-[3.5rem] border border-white shadow-2xl overflow-hidden flex flex-col min-h-[500px]", children: [_jsxs("div", { className: "p-8 border-b border-slate-100 flex justify-between items-center bg-white/50", children: [_jsxs("div", { children: [_jsx("h3", { className: "text-2xl font-black text-slate-800 tracking-tighter", children: "Live GPS & Geofencing" }), _jsx("p", { className: "text-xs font-bold text-slate-400", children: "\u062A\u062A\u0628\u0639 \u062D\u064A \u0645\u0639 \u0645\u064A\u0632\u0629 \u0627\u0644\u0645\u0646\u0627\u0637\u0642 \u0627\u0644\u0622\u0645\u0646\u0629." })] }), _jsxs("button", { onClick: trackLocation, disabled: loadingLocation, className: `px-6 py-3 rounded-2xl font-black text-sm flex items-center gap-3 transition-all active:scale-95 ${loadingLocation ? 'bg-slate-200 text-slate-400' : 'bg-indigo-600 text-white shadow-lg'}`, children: [loadingLocation ? _jsx("span", { className: "animate-spin text-lg", children: "\u23F3" }) : _jsx(ICONS.Location, {}), "\u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0648\u0642\u0639"] })] }), _jsx("div", { className: "flex-1 relative bg-slate-100 flex items-center justify-center overflow-hidden", children: child.location ? (_jsx("iframe", { width: "100%", height: "100%", frameBorder: "0", scrolling: "no", src: `https://maps.google.com/maps?q=${child.location.lat},${child.location.lng}&z=15&output=embed`, className: "absolute inset-0 grayscale-[0.2] contrast-[1.1]" })) : (_jsxs("div", { className: "flex flex-col items-center gap-6 opacity-30", children: [_jsx("div", { className: "text-8xl", children: "\uD83C\uDF0D" }), _jsxs("p", { className: "font-black text-xl text-center", children: ["\u0628\u0627\u0646\u062A\u0638\u0627\u0631 \u0625\u0634\u0627\u0631\u0629 \u0627\u0644\u0640 GPS \u0644\u062C\u0647\u0627\u0632 ", child.name] })] })) })] }), _jsxs("div", { className: "lg:col-span-4 space-y-8", children: [_jsxs("div", { className: "bg-white/80 backdrop-blur-xl p-10 rounded-[3rem] border border-white shadow-xl space-y-8", children: [_jsxs("h3", { className: "text-xl font-black text-slate-800 border-b pb-4 flex items-center gap-3", children: ["\u062A\u062D\u0643\u0645 \u0627\u0644\u0639\u062A\u0627\u062F \u0627\u0644\u0645\u0628\u0627\u0634\u0631 ", _jsx("span", { className: "text-[10px] text-red-500 font-black animate-pulse", children: "LIVE" })] }), _jsxs("div", { className: "space-y-4", children: [_jsx(HardwareToggle, { label: "\u0642\u0641\u0644 \u0627\u0644\u0645\u064A\u0643\u0631\u0648\u0641\u0648\u0646", active: child.micBlocked, icon: "\uD83C\uDF99\uFE0F", onToggle: () => onUpdateDevice(child.id, { micBlocked: !child.micBlocked }) }), _jsx(HardwareToggle, { label: "\u0642\u0641\u0644 \u0627\u0644\u0643\u0627\u0645\u064A\u0631\u0627", active: child.cameraBlocked, icon: "\uD83D\uDCF7", onToggle: () => onUpdateDevice(child.id, { cameraBlocked: !child.cameraBlocked }) }), _jsx(HardwareToggle, { label: "\u0645\u0646\u0639 \u0627\u0644\u062A\u062B\u0628\u064A\u062A", active: child.preventAppInstall, icon: "\uD83D\uDCF2", onToggle: () => onUpdateDevice(child.id, { preventAppInstall: !child.preventAppInstall }) })] })] }), _jsxs("div", { className: "bg-slate-900 rounded-[3rem] p-8 shadow-2xl text-white relative overflow-hidden h-full flex flex-col justify-between group", children: [_jsxs("div", { className: "space-y-6 relative z-10", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: "p-3 bg-indigo-600 rounded-2xl shadow-lg", children: _jsx(ICONS.Shield, {}) }), _jsx("h4", { className: "text-xl font-black tracking-tight", children: "\u062A\u062D\u0644\u064A\u0644 \u0627\u0644\u0645\u062D\u064A\u0637 (AI Ambient)" })] }), _jsx("div", { className: "p-6 bg-white/5 border border-white/10 rounded-2xl italic text-xs font-bold leading-relaxed text-indigo-100", children: locationIntel?.text || "بانتظار بيانات الموقع لتحليل جودة المنطقة المحيطة ودرجة الأمان." })] }), _jsx("div", { className: "absolute -bottom-10 -left-10 w-40 h-40 bg-indigo-600/10 rounded-full blur-3xl group-hover:scale-150 transition-transform" })] })] })] }), _jsxs("div", { className: "bg-white/80 backdrop-blur-xl p-10 rounded-[4rem] border border-white shadow-2xl", children: [_jsxs("div", { className: "flex justify-between items-center mb-10 px-4", children: [_jsx("h3", { className: "text-3xl font-black text-slate-800 tracking-tighter", children: "\u062C\u062F\u0627\u0631 \u062D\u0645\u0627\u064A\u0629 \u0627\u0644\u062A\u0637\u0628\u064A\u0642\u0627\u062A" }), _jsxs("span", { className: "text-[10px] font-black text-slate-400 bg-slate-100 px-4 py-1 rounded-full uppercase", children: ["\u0625\u062C\u0645\u0627\u0644\u064A ", child.appUsage.length, " \u062A\u0637\u0628\u064A\u0642 \u0645\u0631\u0635\u0648\u062F"] })] }), _jsx("div", { className: "grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-6", children: child.appUsage.map(app => (_jsxs("button", { onClick: () => onToggleAppBlock(child.id, app.id), className: `relative w-full aspect-square rounded-[2.5rem] flex flex-col items-center justify-center transition-all border-4 ${app.isBlocked ? 'bg-red-50 border-red-500 shadow-lg' : 'bg-white border-slate-50 hover:scale-105 shadow-sm'}`, children: [_jsx("span", { className: "text-4xl mb-1", children: app.icon }), _jsx("p", { className: "text-[9px] font-black truncate w-full px-2 text-center text-slate-700", children: app.appName }), app.isBlocked && _jsx("div", { className: "absolute inset-0 bg-red-600/5 rounded-[2.5rem] flex items-center justify-center text-2xl", children: "\uD83D\uDEAB" })] }, app.id))) })] })] }));
};
const HardwareToggle = ({ label, active, icon, onToggle }) => (_jsxs("div", { onClick: onToggle, className: `flex items-center justify-between p-6 rounded-[2.5rem] border-2 cursor-pointer transition-all ${active ? 'bg-red-50 border-red-200 shadow-md' : 'bg-slate-50/50 border-transparent hover:bg-slate-100'}`, children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("span", { className: "text-2xl", children: icon }), _jsx("span", { className: "text-sm font-black text-slate-700", children: label })] }), _jsx("div", { className: `w-12 h-7 rounded-full p-1 transition-all ${active ? 'bg-red-600' : 'bg-slate-300'}`, children: _jsx("div", { className: `w-5 h-5 bg-white rounded-full shadow-lg transition-transform ${active ? '-translate-x-5' : 'translate-x-0'}` }) })] }));
export default DevicesView;
