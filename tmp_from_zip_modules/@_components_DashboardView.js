import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { RiskTrend } from '@/types';
import { subscribeToActivities, fetchIncidents } from '@/services/firestoreService';
import { AmanahShield } from '@/constants';
import { AreaChart, Area, ResponsiveContainer, YAxis, XAxis, CartesianGrid, Tooltip } from 'recharts';
const DashboardView = ({ children, alerts, onTriggerDemo, lang, parentId }) => {
    const navigate = useNavigate();
    const [activities, setActivities] = useState([]);
    const [incidents, setIncidents] = useState([]);
    useEffect(() => {
        if (!parentId || parentId === 'guest')
            return;
        const unsub = subscribeToActivities(parentId, setActivities);
        fetchIncidents(parentId).then(setIncidents);
        return () => unsub();
    }, [parentId]);
    const riskGraphData = [
        { time: 'السبت', score: 32 }, { time: 'الأحد', score: 28 }, { time: 'الاثنين', score: 45 },
        { time: 'الثلاثاء', score: 42 }, { time: 'الأربعاء', score: 58 }, { time: 'الخميس', score: 72 }, { time: 'الجمعة', score: 65 }
    ];
    return (_jsxs("div", { className: "space-y-10 pb-44 animate-in fade-in duration-700", dir: "rtl", children: [_jsxs("div", { className: "bg-white/80 backdrop-blur-xl p-8 rounded-[4rem] border border-white shadow-2xl flex flex-col md:flex-row justify-between items-center gap-10", children: [_jsxs("div", { className: "flex items-center gap-6", children: [_jsx("div", { className: "w-20 h-20 bg-[#8A1538] rounded-3xl flex items-center justify-center text-3xl shadow-2xl animate-shield-breathing", children: _jsx(AmanahShield, { className: "w-14 h-14" }) }), _jsxs("div", { children: [_jsx("h2", { className: "text-4xl font-black text-slate-900 tracking-tighter leading-none mb-2", children: "\u0623\u0645\u0627\u0646\u0629 \u0633\u064A\u0641\u0631 \u0643\u0648\u0646\u0633\u0648\u0644" }), _jsx("p", { className: "text-slate-500 font-bold text-lg", children: "\u0646\u0638\u0627\u0645 \u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0623\u0645\u0627\u0646 \u0627\u0644\u0639\u0627\u0626\u0644\u064A \u0648\u0627\u0644\u062A\u062D\u0644\u064A\u0644 \u0627\u0644\u062C\u0646\u0627\u0626\u064A \u0644\u0644\u0623\u0633\u0637\u0648\u0644." })] })] }), _jsxs("div", { className: "flex gap-4", children: [_jsx(QuickActionButton, { label: "\u062E\u0632\u0646\u0629 \u0627\u0644\u0623\u062F\u0644\u0629", icon: "\uD83C\uDFDB\uFE0F", onClick: () => navigate('/evidence'), color: "bg-slate-950" }), _jsx(QuickActionButton, { label: "\u0627\u0644\u062F\u0641\u0627\u0639 \u0627\u0644\u0627\u0633\u062A\u0628\u0627\u0642\u064A", icon: "\uD83D\uDEE1\uFE0F", onClick: () => navigate('/studio'), color: "bg-indigo-600" }), _jsx(QuickActionButton, { label: "\u062A\u062A\u0628\u0639 \u062D\u064A", icon: "\uD83D\uDCE1", onClick: () => navigate('/location'), color: "bg-emerald-600" })] })] }), _jsxs("div", { className: "grid grid-cols-1 xl:grid-cols-12 gap-10", children: [_jsxs("div", { className: "xl:col-span-8 space-y-10", children: [_jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: children.map(child => (_jsx(ChildRiskCard, { child: child, onClick: () => navigate('/pulse') }, child.id))) }), _jsxs("div", { className: "bg-white rounded-[4rem] p-10 shadow-2xl border border-slate-100 space-y-8", children: [_jsxs("div", { className: "flex justify-between items-center border-b border-slate-50 pb-8", children: [_jsxs("div", { children: [_jsx("h3", { className: "text-2xl font-black text-slate-800 tracking-tight", children: "\u062A\u062D\u0644\u064A\u0644 \u0627\u062A\u062C\u0627\u0647 \u0627\u0644\u0645\u062E\u0627\u0637\u0631 \u0627\u0644\u0639\u0627\u0645" }), _jsx("p", { className: "text-slate-400 font-bold text-xs uppercase tracking-widest mt-1", children: "Global Family Risk Index" })] }), _jsx("div", { className: "bg-indigo-50 px-6 py-2 rounded-2xl text-[10px] font-black text-indigo-600 animate-pulse", children: "\u0645\u0632\u0627\u0645\u0646\u0629 \u0633\u062D\u0627\u0628\u064A\u0629 \u0646\u0634\u0637\u0629" })] }), _jsx("div", { className: "h-72 w-full", children: _jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(AreaChart, { data: riskGraphData, children: [_jsx("defs", { children: _jsxs("linearGradient", { id: "colorScore", x1: "0", y1: "0", x2: "0", y2: "1", children: [_jsx("stop", { offset: "5%", stopColor: "#6366f1", stopOpacity: 0.2 }), _jsx("stop", { offset: "95%", stopColor: "#6366f1", stopOpacity: 0 })] }) }), _jsx(CartesianGrid, { strokeDasharray: "3 3", vertical: false, stroke: "#f1f5f9" }), _jsx(XAxis, { dataKey: "time", axisLine: false, tickLine: false, tick: { fontSize: 10, fontWeight: 'bold' } }), _jsx(YAxis, { hide: true }), _jsx(Tooltip, { contentStyle: { borderRadius: '1.5rem', border: 'none', boxShadow: '0 20px 25px -5px rgb(0 0 0 / 0.1)' } }), _jsx(Area, { type: "monotone", dataKey: "score", stroke: "#6366f1", strokeWidth: 4, fillOpacity: 1, fill: "url(#colorScore)" })] }) }) })] })] }), _jsxs("div", { className: "xl:col-span-4 space-y-10", children: [_jsxs("div", { className: "bg-slate-950 rounded-[4rem] p-10 shadow-2xl text-white border-b-[10px] border-[#8A1538] relative overflow-hidden", children: [_jsx("div", { className: "absolute top-0 right-0 w-full h-full bg-[radial-gradient(circle_at_top_right,rgba(138,21,56,0.1)_0%,transparent_60%)] opacity-30" }), _jsxs("div", { className: "relative z-10 space-y-8", children: [_jsxs("div", { className: "flex items-center gap-5", children: [_jsx("div", { className: "w-14 h-14 bg-white/5 rounded-2xl flex items-center justify-center text-2xl border border-white/10 shadow-inner", children: "\uD83D\uDCDC" }), _jsx("h3", { className: "text-2xl font-black tracking-tighter text-[#F7DE8D]", children: "\u063A\u0631\u0641\u0629 \u0639\u0645\u0644\u064A\u0627\u062A \u0627\u0644\u062D\u0648\u0627\u062F\u062B" })] }), _jsxs("div", { className: "space-y-10 relative", children: [_jsx("div", { className: "absolute top-0 bottom-0 right-7 w-px bg-white/5" }), incidents.length > 0 ? incidents.slice(0, 3).map((inc, i) => (_jsxs("div", { className: "relative pr-16 group cursor-pointer", onClick: () => navigate('/incident'), children: [_jsx("div", { className: "absolute top-1.5 right-0 w-14 h-14 bg-white/5 border-2 border-white/10 rounded-2xl flex items-center justify-center text-xs transition-all group-hover:scale-110 group-hover:border-red-600/50", children: _jsx("span", { className: "text-xl", children: "\u26A0\uFE0F" }) }), _jsxs("div", { className: "space-y-2 text-right", children: [_jsx("p", { className: "text-[10px] font-black text-indigo-400 uppercase tracking-widest", children: new Date(inc.startTime).toLocaleTimeString() }), _jsx("h4", { className: "font-black text-sm text-white group-hover:text-red-400 transition-colors", children: inc.category }), _jsxs("p", { className: "text-[10px] text-slate-500 leading-relaxed line-clamp-2 italic", children: ["\"", inc.summary, "\""] })] })] }, i))) : (_jsx("div", { className: "text-center py-10 opacity-30", children: _jsx("p", { className: "font-bold text-xs", children: "\u0644\u0627 \u062A\u0648\u062C\u062F \u062D\u0648\u0627\u062F\u062B \u0646\u0634\u0637\u0629 \u062D\u0627\u0644\u064A\u0627\u064B." }) }))] }), _jsx("button", { onClick: () => navigate('/alerts'), className: "w-full py-5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all", children: "\u0645\u0634\u0627\u0647\u062F\u0629 \u0627\u0644\u0633\u062C\u0644 \u0627\u0644\u0623\u0645\u0646\u064A \u0627\u0644\u0643\u0627\u0645\u0644" })] })] }), _jsxs("div", { className: "bg-white p-10 rounded-[4rem] shadow-2xl border border-slate-100 space-y-8", children: [_jsxs("h3", { className: "text-xl font-black text-slate-800 tracking-tighter border-b border-slate-50 pb-4 flex items-center gap-3", children: ["\u0635\u062D\u0629 \u0627\u0644\u0623\u0633\u0637\u0648\u0644 (Fleet Health)", _jsx("span", { className: "text-[9px] bg-emerald-50 text-emerald-600 px-3 py-1 rounded-full font-black uppercase tracking-tighter animate-pulse", children: "Compliance ON" })] }), _jsx("div", { className: "space-y-6", children: children.slice(0, 3).map(child => (_jsxs("div", { className: "p-5 bg-slate-50/50 rounded-3xl border border-slate-100 flex items-center justify-between group hover:bg-white hover:shadow-lg transition-all", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("img", { src: child.avatar, className: "w-12 h-12 rounded-2xl object-cover shadow-sm grayscale opacity-70 group-hover:grayscale-0 group-hover:opacity-100 transition-all" }), _jsxs("div", { children: [_jsx("p", { className: "text-xs font-black text-slate-800", children: child.name }), _jsx("p", { className: "text-[9px] font-bold text-slate-400 uppercase", children: child.deviceNickname || 'fleet_node_01' })] })] }), _jsxs("div", { className: "flex flex-col items-end gap-1", children: [_jsx("span", { className: `w-3 h-3 rounded-full ${child.status === 'online' ? 'bg-emerald-500 shadow-[0_0_10px_#10b981]' : 'bg-slate-300'}` }), _jsx("span", { className: `text-[8px] font-black uppercase tracking-widest ${child.riskProfile?.isCompliant ? 'text-emerald-600' : 'text-red-500'}`, children: child.riskProfile?.isCompliant ? 'Compliant' : 'Warning' })] })] }, child.id))) }), _jsxs("button", { onClick: () => navigate('/integrity'), className: "w-full py-6 bg-slate-900 text-white rounded-3xl font-black text-xs uppercase shadow-xl hover:bg-indigo-600 transition-all flex items-center justify-center gap-4", children: [_jsx("span", { children: "\uD83D\uDC8E" }), "\u062A\u062F\u0642\u064A\u0642 \u0627\u0644\u0646\u0632\u0627\u0647\u0629 \u0627\u0644\u0639\u0627\u0644\u0645\u064A"] })] })] })] })] }));
};
const QuickActionButton = ({ label, icon, onClick, color }) => (_jsxs("button", { onClick: onClick, className: `${color} text-white px-8 py-5 rounded-3xl font-black text-sm shadow-xl active:scale-95 transition-all flex items-center gap-3 hover:scale-105`, children: [_jsx("span", { className: "text-xl", children: icon }), _jsx("span", { className: "whitespace-nowrap", children: label })] }));
const ChildRiskCard = ({ child, onClick }) => {
    const isDanger = (child.riskScore?.childScore || 0) > 60;
    return (_jsxs("div", { className: "bg-white rounded-[3.5rem] p-10 border-2 border-slate-50 shadow-xl relative overflow-hidden group hover:shadow-2xl transition-all cursor-pointer", onClick: onClick, children: [_jsx("div", { className: `absolute top-0 right-0 w-full h-2 ${isDanger ? 'bg-red-600' : 'bg-emerald-500'}` }), _jsxs("div", { className: "flex justify-between items-start mb-8", children: [_jsxs("div", { className: "flex items-center gap-6", children: [_jsxs("div", { className: "relative", children: [_jsx("img", { src: child.avatar, className: "w-20 h-20 rounded-[2rem] object-cover border-4 border-white shadow-xl group-hover:scale-110 transition-transform duration-500" }), _jsx("div", { className: `absolute -bottom-1 -right-1 w-6 h-6 rounded-full border-4 border-white shadow-md ${child.status === 'online' ? 'bg-emerald-500' : 'bg-slate-300'}` })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("h4", { className: "text-2xl font-black text-slate-800", children: child.name }), _jsx("p", { className: "text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]", children: child.deviceNickname || 'fleet_node_01' })] })] }), _jsxs("div", { className: "text-left", children: [_jsx("p", { className: "text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1", children: "Risk Score" }), _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("span", { className: `text-4xl font-black tracking-tighter ${isDanger ? 'text-red-600' : 'text-emerald-600'}`, children: child.riskScore?.childScore || 12 }), _jsx("span", { className: `text-sm ${child.riskScore?.trend === RiskTrend.UP ? 'text-red-500' : 'text-emerald-500'}`, children: child.riskScore?.trend === RiskTrend.UP ? '▲' : '▼' })] })] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { className: "bg-slate-50 p-4 rounded-2xl flex items-center justify-between border border-slate-100", children: [_jsx("span", { className: "text-2xl", children: "\uD83D\uDD0B" }), _jsxs("div", { className: "text-left", children: [_jsx("p", { className: "text-[9px] font-black text-slate-400 uppercase", children: "Battery" }), _jsxs("p", { className: "font-black text-slate-800", children: [child.batteryLevel, "%"] })] })] }), _jsxs("div", { className: "bg-slate-50 p-4 rounded-2xl flex items-center justify-between border border-slate-100", children: [_jsx("span", { className: "text-2xl", children: "\uD83D\uDCF6" }), _jsxs("div", { className: "text-left", children: [_jsx("p", { className: "text-[9px] font-black text-slate-400 uppercase", children: "Signal" }), _jsxs("p", { className: "font-black text-slate-800", children: [child.signalStrength, "/4"] })] })] })] })] }));
};
export default DashboardView;
