# وصف تفصيلي لتنسيقات ملف walkthrough.md.resolved

**المسار:** `C:\Users\PC\.gemini\antigravity\brain\d119aad2-4490-4e2f-a4fe-77130dbd2a48\walkthrough.md.resolved`

**الحجم:** 3141 سطر

**المُنشئ:** Gemini (نظام Antigravity)

---

## 1. البنية العامة

الملف هو مستند Markdown تم إنشاؤه بواسطة **Gemini** عبر نظام Antigravity كدليل تنفيذ (walkthrough) لمشروع أمانة. يغطي 3 مراحل تطوير (A, B, C) ويحتوي على الكود المصدري الكامل لملف `firestoreService.ts` بنسختيه (قبل وبعد التعديل).

---

## 2. هيكل العناوين (Headings)

```
# H1 → عنوان رئيسي واحد: "Amanah System — Phases A, B, C Walkthrough"
## H2 → أقسام كبرى: "Completed Changes", "Remaining Action Items"
### H3 → المراحل الفرعية: "Phase A: Critical Fixes ✅", "Phase B: ...", "Phase C: ..."
```

- كل عنوان `H3` يتبعه رمز حالة: `✅` (مكتمل) أو `⏳` (معلق)

---

## 3. جداول الملخص (Summary Tables)

كل مرحلة تبدأ بجدول Markdown يلخص التغييرات:

```markdown
| Change | File | Status |
|---|---|---|
| وصف التغيير | [اسم_الملف](file:///مسار_مطلق) | ✅ Applied |
```

- **Phase A** تستخدم أعمدة: `| Change | File | Status |`
- **Phase B/C** تستخدم أعمدة مختلفة: `| Service | Purpose | Lines |`
- الروابط تستخدم بروتوكول `file:///` مع مسارات Windows المطلقة

---

## 4. كتل الكود (Code Blocks) — التنسيق الأهم

```
‎```diff:firestoreService.ts
[الكود الكامل للنسخة القديمة]
===
[الكود الكامل للنسخة الجديدة]
‎```
```

### الخصائص:

- تبدأ بـ `` ```diff:اسم_الملف `` — رغم أنها ليست unified diff حقيقي، بل **كود مصدري كامل**
- الفاصل `===` (سطر مفرد) يفصل بين **النسخة القديمة (Before)** و**النسخة الجديدة (After)** لنفس الملف
- النسخة القديمة: السطور 13–1549 (~1537 سطر من firestoreService.ts الأصلي)
- النسخة الجديدة: السطور 1551–3110 (~1560 سطر من firestoreService.ts المعدّل)
- الكتلة تُغلق بـ `` ``` `` في السطر 3110
- **لا يُستخدم** نمط `+`/`-` لتمييز الأسطر المضافة/المحذوفة

---

## 5. الفروقات بين النسختين (Before vs After)

الملف لا يستخدم `+`/`-` لتمييز التغييرات. بدلاً من ذلك، يجب مقارنة النسختين يدوياً. أبرز الفروقات:

| الجانب | النسخة القديمة (Before) | النسخة الجديدة (After) |
|---|---|---|
| رسائل الأخطاء | إنجليزي فقط | ثنائية اللغة `عربي. \| English.` |
| Retry logic | غير موجودة | `retryWithBackoff()` مع exponential backoff |
| `mapInviteEmailError` | `'Invalid invitation email address.'` | `'عنوان البريد الإلكتروني غير صالح. \| Invalid invitation email address.'` |
| `sendCoParentInvitationEmail` | استدعاء مباشر | ملفوف بـ `retryWithBackoff()` |

---

## 6. الفواصل (Separators)

| الرمز | الاستخدام |
|---|---|
| `---` | Horizontal Rule — يفصل بين المراحل (Phase A, B, C) |
| `===` | يفصل بين نسختي الكود (Before/After) داخل كتلة diff واحدة |

---

## 7. نمط الروابط

جميع الروابط تتبع هذا النمط:

```markdown
[اسم_الملف.ts](file:///d:/Projects/copy2-of-latest-copy-of-copy4-of-amanah_-parental-control-ai/path/to/file.ts)
```

- بروتوكول `file:///` مع مسارات مطلقة على Windows
- بعض الروابط تتضمن نطاق أسطر مثل: `#40-282`

---

## 8. قائمة المهام المتبقية (Action Items)

```markdown
## Remaining Action Items

1. **عنوان المهمة** — وصف تفصيلي مع روابط [file:///...]
2. ...
```

- قائمة مرقمة (1-5) في نهاية الملف (سطور 3135-3141)
- كل عنصر يبدأ بعنوان عريض (**bold**) يتبعه شرطة طويلة (`—`) ثم الوصف

---

## 9. اللغة

| السياق | اللغة |
|---|---|
| العناوين والبنية | إنجليزية بالكامل |
| التعليقات في الكود | مزيج عربي/إنجليزي |
| رسائل الأخطاء (النسخة القديمة) | إنجليزي فقط |
| رسائل الأخطاء (النسخة الجديدة) | ثنائية بنمط `عربي. \| English.` |

---

## 10. خريطة المحتوى الكاملة

| نطاق الأسطر | المحتوى |
|---|---|
| سطر 1 | عنوان H1: `# Amanah System — Phases A, B, C Walkthrough` |
| سطور 3-11 | H2 + H3 + جدول Phase A |
| سطر 13 | بداية كتلة الكود: `` ```diff:firestoreService.ts `` |
| سطور 14-1549 | النسخة القديمة من `firestoreService.ts` (كود كامل) |
| سطر 1550 | فاصل `===` بين النسختين |
| سطور 1551-3109 | النسخة الجديدة من `firestoreService.ts` (كود كامل مع التحسينات) |
| سطر 3110 | إغلاق كتلة الكود: `` ``` `` |
| سطور 3112-3113 | فاصل `---` + فراغ |
| سطور 3114-3121 | H3 Phase B + جدول (4 خدمات) |
| سطور 3123-3124 | فاصل `---` |
| سطور 3125-3132 | H3 Phase C + جدول (3 خدمات Android) |
| سطور 3134-3135 | فاصل `---` + H2 Remaining Action Items |
| سطور 3137-3141 | قائمة مرقمة بـ 5 مهام متبقية |
